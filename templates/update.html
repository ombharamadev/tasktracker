<!DOCTYPE html>
<html data-bs-theme="light" lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no">
    <title>Update Task</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/Alkalami.css">
    <link rel="stylesheet" href="assets/css/Navbar-Centered-Brand-Dark-icons.css">
    <link rel="stylesheet" href="assets/css/Sidebar-Menu-sidebar.css">
    <link rel="stylesheet" href="assets/css/Sidebar-Menu.css">
    <link rel="stylesheet" href="assets/css/SIdebar-Responsive-2-ResponsiveSideBar-2.css">
    <link rel="stylesheet" href="assets/css/SIdebar-Responsive-2.css">
    <link rel="stylesheet" href="assets/css/sidebar-style4.css">
    <link rel="stylesheet" href="assets/css/sidebar.css">
</head>

<body>
    <nav class="navbar navbar-expand-md bg-dark py-3" data-bs-theme="dark">
        <div class="container"><a class="navbar-brand d-flex align-items-center" href="#"><span class="bs-icon-sm bs-icon-rounded bs-icon-primary d-flex justify-content-center align-items-center me-2 bs-icon"><svg xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16" class="bi bi-list-task">
                        <path fill-rule="evenodd" d="M2 2.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-.5-.5zM3 3H2v1h1z"></path>
                        <path d="M5 3.5a.5.5 0 0 1 .5-.5h9a.5.5 0 0 1 0 1h-9a.5.5 0 0 1-.5-.5M5.5 7a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1zm0 4a.5.5 0 0 0 0 1h9a.5.5 0 0 0 0-1z"></path>
                        <path fill-rule="evenodd" d="M1.5 7a.5.5 0 0 1 .5-.5h1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H2a.5.5 0 0 1-.5-.5zM2 7h1v1H2zm0 3.5a.5.5 0 0 0-.5.5v1a.5.5 0 0 0 .5.5h1a.5.5 0 0 0 .5-.5v-1a.5.5 0 0 0-.5-.5zm1 .5H2v1h1z"></path>
                    </svg></span><span style="font-size: 27px;">TaskTracker</span></a><button data-bs-toggle="collapse" class="navbar-toggler" data-bs-target="#navcol-6"><span class="visually-hidden">Toggle navigation</span></button>
            <div class="collapse navbar-collapse flex-grow-0 order-md-first" id="navcol-6">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"></li>
                    <li class="nav-item"></li>
                </ul>
                <div class="d-md-none my-2"><button class="btn btn-light me-2" type="button">Button</button><button class="btn btn-primary" type="button">Button</button></div>
            </div>
            <div class="d-none d-md-block"></div>
        </div>
    </nav>
    
    <section>
        <h1 style="text-align: center;">Update Task</h1>
        <div>
            <input type="hidden" id="task_id" name="task_id" value="{{ task_id }}"></input>
            <div class="container">
                <div class="row" style="margin-top: 22px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;font-family: Alkalami, serif;">Title</label></div>
                    <div class="col-md-6"><input type="text"  id="title" value="{{title}}" name= "title" style="width: 100%;height: 100%;"></div>
                </div>
                <div class="row" style="margin-top: 22px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;">Description</label></div>
                    <div class="col-md-6" style="height: 151px;"> <input id="desc" type="text" value="{{desc}}" name="desc" style="width: 100%;height: 100%;"></input></div>
                </div>
                <div class="row" style="margin-top: 25px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;">Assign To</label></div>
                    <div class="col-md-6"><select multiple="" id="assignto" name="assignto" style="width: 100%;min-width: 100%;">
                            
                        </select></div>
                </div>
                <div class="row" style="margin-top: 25px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;">Due Date</label></div>
                    <div class="col-md-6"><input id="duedate" value="{{due_date|date:'Y-m-d'}}" name="duedate" type="date" style="width: 100%;min-width: 100%;"></div>
                </div>
                <div class="row" style="margin-top: 25px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;">Status</label></div>
                    <div class="col-md-6">
                        <select id="taskstatus" name="taskstatus" style="width: 100%; height: 100%;">
                            <option value="todo" {% if task_status == 'todo' %} selected {% endif %}>Todo</option>
                            <option value="inprogress" {% if task_status == 'inprogress' %} selected {% endif %}>InProgress</option>
                            <option value="done" {% if task_status == 'done' %} selected {% endif %}>Done</option>
                        </select>
                    </div>
                    
                <div class="row" style="margin-top: 25px;">
                    <div class="col-md-6" style="text-align: center;"><label class="col-form-label" style="font-size: 26px;"></label></div>
                    <div class="col-md-6"><button class="btn btn-primary" onclick="addtask()" type="submit" style="width: 100%;height: 100%;">Save</button></div>
                </div>
            </div>
            
        </div>
    </section>
    <footer class="text-center bg-dark" style="margin-top: 84px;">
        <div class="container text-white py-4 py-lg-5"><img class="rounded-circle" src="/assets/img/jaswalaryan.jpg" style="min-width: 100px;max-width: 150px;">
            <h4>Made By Jaswal Aryan</h4>
            <p>jaswalaryan@proton.me</p>
        </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/Sidebar-Menu-sidebar.js"></script>



<script>
    function deletetask(){
        let task_id = document.getElementById("task_id").value;

        const url = '/api/deletepost';
        const data = {
            'task_id':task_id
        };

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
    
        .catch(error => console.error('Error:', error));




    }
    function addtask(){

        let title = document.getElementById("title").value;
        let desc = document.getElementById("desc").value;
        let duedate = document.getElementById("duedate").value;
        let taskstatus = document.getElementById("taskstatus").value;

        const url = '/api/addtask';
        const data = {
            'title':title,
            'desc': desc,
            'due_date': duedate,
            'task_status':taskstatus
        };

        fetch(url, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        })
        .then(response => response.json())
        .then(data => {
    if (data.status === 'Success') {
        assignto(data.task_id);
        alert("Update the Task");
        deletetask();
        document.location.href = "/dashboard"
    } else {
        alert(data.status);
    }
    
    })
        .catch(error => console.error('Error:', error));


    }

    function assignto(task_id){
        let a = document.getElementById("assignto");
        let lena = a.selectedOptions.length;
        for(let i=0; i<lena ; i++){
            assing_to = a.selectedOptions[i].value;
            
            const url = '/api/assignto';
            const data = {
                'task_id' : task_id,
                'assign_email' : assing_to
            };

            fetch(url, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(data)
            })
            .then(response => response.json())
            
            .catch(error => console.error('Error:', error));

        }
    }
</script>






<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('/api/getemaillist?format=json')
            .then(response => response.json())
            .then(data => {
                const select = document.getElementById('assignto');
                data.forEach(email => {
                    const option = document.createElement('option');
                    option.value = email;
                    option.textContent = email;
                    select.appendChild(option);
                });
            })
            .catch(error => console.error('Error fetching email list:', error));
    });
</script>

</body>

</html>